<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA X AI - Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        :root {
            --bg-dark-primary: #1a202c; /* Dark Charcoal */
            --bg-dark-secondary: #2d3748; /* Slightly Lighter Charcoal */
            --bg-dark-tertiary: #171923; /* Even Darker for depth */
            --text-light-primary: #edf2f7; /* Light Gray */
            --text-light-secondary: #a0aec0; /* Medium Gray */
            --accent-primary: #38b2ac; /* Teal */
            --accent-secondary: #4299e1; /* Vibrant Blue */
            --card-border-color: #4a5568; /* Dark Gray border */
            --shadow-color: rgba(0, 0, 0, 0.4);
            --shadow-accent-glow: rgba(56, 178, 172, 0.3); /* Teal glow */

            --win-color: #38a169; /* Green */
            --loss-color: #e53e3e; /* Red */
            --pending-color: #dd6b20; /* Orange */
            --skipped-color: #718096; /* Gray */
            --warning-color: #f59e0b; /* Amber - for pending/warning states in login */
            --maintenance-text-color: #ecc94b; /* Yellow for maintenance */

            --input-bg-dark: rgba(45, 55, 72, 0.7);
            --input-border-dark: var(--card-border-color);
            --input-focus-border-dark: var(--accent-primary);
            --input-focus-shadow-dark: var(--shadow-accent-glow);
        }

        body {
            font-family: 'El Messiri', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark-primary), var(--bg-dark-secondary));
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
            padding: 0;
            color: var(--text-light-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }
        * {
            color: var(--text-light-primary);
        }

        .auth-screen {
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 95vh; 
            padding: 1rem;
            animation: fadeInAuthAlphaX 0.7s ease-out;
        }
        .auth-screen.active {
            display: flex;
        }

        @keyframes fadeInAuthAlphaX {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-container-alphax {
            background: var(--bg-dark-secondary);
            padding: 2rem 2.5rem;
            border-radius: 1.5rem; 
            box-shadow: 0 10px 25px var(--shadow-color);
            width: 100%;
            max-width: 450px;
            text-align: center;
            border: 1px solid var(--card-border-color);
        }

        .auth-title-svg-alphax { 
            width: 100%;
            max-width: 350px; 
            margin: 0 auto 1.5rem auto;
        }
        .auth-title-svg-alphax svg text {
            font-family: 'El Messiri', sans-serif; text-anchor: middle; dominant-baseline: middle;
            text-transform: uppercase; animation: strokeLoginDark 5s infinite alternate;
            stroke-width: 1.2; stroke: var(--accent-primary);
            font-size: 50px; 
            fill: rgba(26, 32, 44, 0); letter-spacing: 1px;
        }
         @keyframes strokeLoginDark { 
            0% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-primary); stroke-dashoffset: 25%; stroke-dasharray: 0 50%; stroke-width: 1.2; }
            70% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-secondary); }
            80% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-primary); stroke-width: 2.5; }
            100% { fill: var(--text-light-primary); stroke: rgba(56, 178, 172, 0); stroke-dashoffset: -25%; stroke-dasharray: 50% 0; stroke-width: 0; }
        }

        .auth-subtitle-alphax {
            font-size: 0.9rem;
            color: var(--text-light-secondary);
            margin-bottom: 1.5rem;
        }

        .form-input-alphax {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--input-border-dark);
            border-radius: 1rem; 
            margin-bottom: 1rem;
            font-size: 1rem;
            background-color: var(--input-bg-dark);
            color: var(--text-light-primary);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input-alphax:focus {
            outline: none;
            border-color: var(--input-focus-border-dark);
            box-shadow: 0 0 0 4px var(--input-focus-shadow-dark);
        }

        .auth-button-alphax { 
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-dark-tertiary);
            padding: 0.9rem 1.8rem; border-radius: 1rem; font-weight: 600;
            transition: all 0.3s ease; border: none; cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center; gap: 0.6rem;
            text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 5px 12px rgba(0,0,0,0.2); width: 100%;
        }
        .auth-button-alphax:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 8px 18px var(--shadow-accent-glow);
        }
        .auth-button-alphax:disabled {
            background: #4a5568; color: var(--text-light-secondary);
            cursor: not-allowed; opacity: 0.8;
        }
        
        .auth-form-toggle {
            font-size: 0.85rem;
            color: var(--text-light-secondary);
            margin-top: 1.5rem;
        }
        .auth-form-toggle button {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }
        .auth-form-toggle button:hover {
            color: var(--accent-secondary);
        }

        .status-message-container-alphax {
            margin-top: 1rem; padding: 0.75rem; border-radius: 1rem;
            font-size: 0.9rem; min-height: 40px; 
            display: flex; align-items: center; justify-content: center; text-align: center;
            border: 1px solid transparent; 
            transition: all 0.3s ease;
        }
        .status-message-container-alphax.error {
            background-color: rgba(229, 62, 62, 0.1); 
            color: var(--loss-color);
            border-color: var(--loss-color);
        }
         .status-message-container-alphax.success {
            background-color: rgba(56, 161, 105, 0.1); 
            color: var(--win-color);
            border-color: var(--win-color);
        }
        .status-message-container-alphax.info {
            background-color: rgba(66, 153, 225, 0.1); 
            color: var(--accent-secondary);
            border-color: var(--accent-secondary);
        }


        #maintenanceContainer { display: none; width:100%; max-width:450px; padding:2rem; animation: fadeInLogin 0.8s ease-in-out;}
        #maintenanceContainer.active { display: block; }
        .maintenance-card { background: var(--bg-dark-secondary); border-radius: 1.5rem; box-shadow: 0 10px 25px var(--shadow-color); padding: 2.5rem; border: 1px solid var(--card-border-color); text-align: center;}
        .maintenance-card i { font-size: 3rem; color: var(--maintenance-text-color); margin-bottom: 1rem; }
        .maintenance-card h2 { color: var(--maintenance-text-color); margin-bottom: 0.5rem; }

        #appContainer { display: none; width: 100%; }
        #appContainer.active { display: block; }

        #accessDeniedScreen {
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            margin: auto;
        }
        #accessDeniedScreen.active { display: flex; }
        .access-denied-card {
            background: var(--bg-dark-secondary);
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px var(--shadow-color);
            border: 1px solid var(--card-border-color);
        }
        .access-denied-card i {
            font-size: 3rem;
            color: var(--loss-color); 
            margin-bottom: 1rem;
        }
        .access-denied-card h2 {
            color: var(--text-light-primary);
            font-size: 1.75rem;
            margin-bottom: 0.75rem;
        }
        .access-denied-card p {
            color: var(--text-light-secondary);
            margin-bottom: 1.5rem;
        }
        .access-denied-card .contact-admin-link {
            color: var(--accent-primary);
            text-decoration: underline;
            font-weight: 500;
        }
        .access-denied-card .contact-admin-link:hover {
            color: var(--accent-secondary);
        }

        .popup, .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(45, 55, 72, 0.95); padding: 1.5rem; border-radius: 1.5rem; box-shadow: 0 6px 16px var(--shadow-color); backdrop-filter: blur(8px); z-index: 1000; width: 90%; max-width: 400px; border: 1px solid var(--accent-primary); text-align: center; }
        .popup h3, .modal h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-light-primary); }
        .popup p, .modal p { margin-bottom: 1.5rem; color: var(--text-light-secondary); font-size: 0.9rem; }
        .popup .button-group, .modal .button-group { display: flex; justify-content: space-around; gap: 1rem; }
        .popup button, .modal button { padding: 0.6rem 1.2rem; border-radius: 0.75rem; font-weight: 500; transition: all 0.2s ease; border: none; cursor: pointer; min-width: 100px; }
        .popup button.primary, .modal button.primary { background: var(--accent-primary); color: var(--bg-dark-tertiary); }
        .popup button.primary:hover, .modal button.primary:hover { background: var(--accent-secondary); }
        .popup button.secondary, .modal button.secondary { background: var(--bg-dark-tertiary); color: var(--text-light-primary); border: 1px solid var(--card-border-color); }
        .popup button.secondary:hover, .modal button.secondary:hover { background: var(--card-border-color); }
        .popup button.danger, .modal button.danger { background: var(--loss-color); color: var(--text-light-primary); }
        .popup button.danger:hover, .modal button.danger:hover { background: #c53030; }
        .popup.active, .modal.active { display: block; animation: fadeInPopup 0.3s ease-out; }
        @keyframes fadeInPopup { from { opacity: 0; transform: translate(-50%, -45%) scale(0.95); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
        .card { transition: all 0.3s ease; background: var(--bg-dark-secondary); border-radius: 1.5rem; box-shadow: 0 6px 12px var(--shadow-color); backdrop-filter: blur(5px); position: relative; margin: 0.75rem; overflow: hidden; border: 1px solid var(--card-border-color); }
        .card:hover { transform: translateY(-6px) scale(1.03); box-shadow: 0 8px 16px var(--shadow-accent-glow); border-color: var(--accent-primary); }
        .gradient-bg { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        #appHeaderSvgContainer svg { width: 100%; height: auto; margin: 0 auto; display: block; }
        #appHeaderSvgContainer svg text { text-anchor: middle; dominant-baseline: middle; text-transform: uppercase; animation: strokeAppHeaderDark 5s infinite alternate; stroke-width: 1.2; stroke: var(--accent-primary); font-size: 130px; fill: rgba(26, 32, 44, 0); }
        @media (max-width: 768px) { #appHeaderSvgContainer svg text { font-size: 90px; } }
        @keyframes strokeAppHeaderDark { 0% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-primary); stroke-dashoffset: 25%; stroke-dasharray: 0 50%; stroke-width: 1.2; } 70% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-secondary); } 80% { fill: rgba(26, 32, 44, 0); stroke: var(--accent-primary); stroke-width: 2.5; } 100% { fill: var(--text-light-primary); stroke: rgba(56, 178, 172, 0); stroke-dashoffset: -25%; stroke-dasharray: 50% 0; stroke-width: 0; } }
        .history-container { display: flex; flex-direction: column; gap: 1rem; max-height: none; overflow: visible; position: relative; }
        .history-item { transition: all 0.3s ease; width: 100%; max-width: 100%; margin: 0; border-radius: 1.2rem; backdrop-filter: blur(5px); box-shadow: 0 4px 14px rgba(0,0,0,0.2); position: relative; overflow: hidden; padding: 1.2rem; border-left: 4px solid transparent; }
        .history-item.win { border-left-color: var(--win-color); background: linear-gradient(135deg, rgba(56, 161, 105, 0.2), var(--bg-dark-secondary)); }
        .history-item.loss { border-left-color: var(--loss-color); background: linear-gradient(135deg, rgba(229, 62, 62, 0.2), var(--bg-dark-secondary)); }
        .history-item.pending { border-left-color: var(--pending-color); background: linear-gradient(135deg, rgba(221, 107, 32, 0.2), var(--bg-dark-secondary)); }
        .history-item.skipped { border-left-color: var(--skipped-color); background: linear-gradient(135deg, rgba(113, 128, 150, 0.2), var(--bg-dark-secondary)); }
        .history-item:hover { transform: scale(1.02); box-shadow: 0 6px 18px var(--shadow-accent-glow); }
        .history-item.fade-out { animation: fadeOut 0.5s ease forwards; }
        @keyframes fadeOut { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(0.95); height: 0; padding: 0; margin: 0; } }
        .history-item .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 1.5rem; color: rgba(74, 85, 104, 0.2); pointer-events: none; z-index: 0; text-transform: uppercase; font-weight: bold; }
        .small-dot { position: absolute; width: 6px; height: 6px; background: var(--accent-secondary); border-radius: 50%; animation: float 4s infinite; z-index: 1; }
        @keyframes float { 0% { transform: translate(0, 0); opacity: 0.7; } 50% { transform: translate(12px, -12px); opacity: 0.3; } 100% { transform: translate(0, 0); opacity: 0.7; } }
        .delete-btn:hover { color: var(--accent-primary); transform: scale(1.3); }
        .status-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; position: relative; overflow: hidden; }
        .status-icon::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; opacity: 0.1; background: radial-gradient(circle, currentColor 0%, transparent 70%); }
        .win-icon { color: var(--win-color); animation: pulseWin 1.5s infinite; }
        .loss-icon { color: var(--loss-color); animation: pulseLoss 1s infinite; }
        .pending-icon { color: var(--pending-color); animation: rotate 2s infinite linear; }
        .skipped-icon { color: var(--skipped-color); animation: pulseSkip 1.5s infinite; }
        @keyframes pulseWin { 0%, 100% { box-shadow: 0 0 0 0 rgba(56, 161, 105, 0.5); } 50% { box-shadow: 0 0 0 10px rgba(56, 161, 105, 0); } }
        @keyframes pulseLoss { 0%, 100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.5); } 50% { box-shadow: 0 0 0 10px rgba(229, 62, 62, 0); } }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulseSkip { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        @keyframes bounceInItem { 0% { transform: scale(0.95) translateY(8px); opacity: 0; } 70% { transform: scale(1.01) translateY(-1px); opacity: 1; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        .animate-bounceIn { animation-name: bounceInItem; animation-duration: 0.35s; animation-timing-function: ease-out; animation-fill-mode: forwards; opacity:0; }
        .dashboard-card { background: var(--bg-dark-tertiary); border-radius: 1.5rem; padding: 1.2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); backdrop-filter: blur(5px); transition: all 0.3s ease; border: 1px solid var(--card-border-color); }
        .dashboard-card:hover { transform: translateY(-4px); box-shadow: 0 6px 14px var(--shadow-accent-glow); border-color: var(--accent-primary); }
        .confidence-meter { height: 10px; background: var(--bg-dark-primary); border-radius: 5px; overflow: hidden; position: relative; }
        .confidence-fill { height: 100%; background: var(--accent-primary); transition: width 0.5s ease; }
        .navigation { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 380px; height: 70px; background: rgba(45, 55, 72, 0.9); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; border-radius: 1.5rem; box-shadow: 0 6px 12px var(--shadow-color); z-index: 1000; border: 1px solid var(--card-border-color); }
        .navigation ul { display: flex; width: 100%; justify-content: space-around; padding: 0 10px; }
        .navigation ul li { position: relative; list-style: none; width: 25%; height: 70px; z-index: 1; display: flex; align-items: center; justify-content: center;}
        .navigation ul li a { position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column; width: 100%; text-align: center; font-weight: 500; padding-top: 5px; }
        .navigation ul li a .icon { position: relative; display: block; line-height: initial; font-size: 1.5em; text-align: center; transition: 0.5s ease; color: var(--text-light-secondary); transform: translateY(0px); }
        .navigation ul li.active a .icon { transform: translateY(-18px); color: var(--accent-primary); }
        .navigation ul li a .text { position: absolute; font-weight: 400; font-size: 0.75em; letter-spacing: 0.05em; transition: 0.5s ease; opacity: 0; transform: translateY(20px); color: var(--text-light-primary); bottom: 8px; }
        .navigation ul li.active a .text { opacity: 1; transform: translateY(0px); color: var(--accent-primary); }
        .navigation ul li a::after { content: ''; position: absolute; bottom: -2px; left: 50%; transform: translateX(-50%); width: 0; height: 3px; background-color: var(--accent-primary); border-radius: 3px; transition: width 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .navigation ul li.active a::after { width: 50%; }
        .settings-group { background-color: rgba(0,0,0,0.1); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1.5rem; border: 1px solid var(--card-border-color); }
        .settings-group-title { font-size: 1rem; font-weight: 600; color: var(--accent-secondary); margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--card-border-color); }
        .mode-toggle { display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0; }
        .mode-toggle label { font-size: 0.9rem; color: var(--text-light-secondary); flex-grow: 1; }
        .mode-switch { position: relative; display: inline-block; width: 50px; height: 26px; flex-shrink: 0; margin-left:1rem; }
        .mode-switch input { opacity: 0; width: 0; height: 0; }
        .mode-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--input-bg-dark); transition: .4s; border-radius: 26px; border: 1px solid var(--card-border-color); }
        .mode-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: var(--text-light-secondary); transition: .4s; border-radius: 50%; }
        input:checked + .mode-slider { background-color: var(--accent-primary); }
        input:checked + .mode-slider:before { transform: translateX(24px); background-color: var(--bg-dark-tertiary); }
        .mode-icons { display: flex; justify-content: space-between; width: 50px; flex-shrink: 0; margin-left:0.5rem; }
        .mode-icons span, .mode-icons i { font-size: 0.8rem; color: var(--text-light-secondary); line-height: 26px; }
        input:checked ~ .mode-icons span:first-child, input:checked ~ .mode-icons i:first-child { color: var(--text-light-secondary); opacity: 0.6; }
        input:not(:checked) ~ .mode-icons span:last-child, input:not(:checked) ~ .mode-icons i:last-child { color: var(--text-light-secondary); opacity: 0.6; }
        input:checked ~ .mode-icons span:last-child, input:checked ~ .mode-icons i:last-child { color: var(--accent-primary); opacity: 1; }
        input:not(:checked) ~ .mode-icons span:first-child, input:not(:checked) ~ .mode-icons i:first-child { color: var(--accent-primary); opacity: 1; }
        .period-id { font-family: monospace; letter-spacing: 2px; font-size: 1.2rem; color: var(--accent-secondary); }
        #currentPeriod, #currentResult { border: none !important; background-color: var(--bg-dark-tertiary) !important; color: var(--text-light-primary) !important; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000; border-radius: 1rem; margin-top: 1rem;}
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 1rem; }
        button, .btn { padding: 0.6rem 1.2rem; border-radius: 0.75rem; font-weight: 600; transition: all 0.3s ease; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 3px 8px rgba(0,0,0,0.15); }
        button.primary-btn, .btn.primary-btn { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: var(--bg-dark-tertiary); }
        button.primary-btn:hover, .btn.primary-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 5px 12px var(--shadow-accent-glow); }
        button.secondary-btn, .btn.secondary-btn { background: var(--bg-dark-tertiary); color: var(--text-light-primary); border: 1px solid var(--card-border-color); }
        button.secondary-btn:hover, .btn.secondary-btn:hover { background: var(--card-border-color); color: var(--text-light-primary); }
        .bad-trend-indicator { background-color: var(--loss-color); color: var(--text-light-primary); padding: 0.75rem 1rem; border-radius: 0.75rem; margin: 0.5rem auto; text-align: center; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; animation: pulseWarning 1.5s infinite; max-width: 95%; }
        @keyframes pulseWarning { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.02); } }
        .toast-login { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background-color: var(--bg-dark-tertiary); color: var(--text-light-primary); padding: 1rem 1.5rem; border-radius: 1rem; box-shadow: 0 4px 12px var(--shadow-color); z-index: 2000; display: flex; align-items: center; gap: 0.75rem; font-size: 0.9rem; border: 1px solid var(--card-border-color); animation: toast-slide-in-out-login 4s forwards; }
        @keyframes toast-slide-in-out-login { 0% { bottom: -60px; opacity: 0; } 15% { bottom: 90px; opacity: 1; } 85% { bottom: 90px; opacity: 1; } 100% { bottom: -60px; opacity: 0; } }
        .toast-login .icon { font-size: 1.2rem; }
        .toast-login .icon.success { color: var(--win-color); }
        .toast-login .icon.error { color: var(--loss-color); }
        .toast-login .icon.info { color: var(--accent-secondary); }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--accent-primary); color: var(--bg-dark-tertiary); padding: 10px 20px; border-radius: 8px; z-index: 1001; box-shadow: 0 2px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s ease, bottom 0.3s ease; }
        .toast.show { opacity: 1; bottom: 90px; }
        .text-slate-700 { color: var(--text-light-secondary) !important; }
        .bg-slate-100 { background-color: var(--bg-dark-primary) !important; }
        .border-slate-300 { border-color: var(--card-border-color) !important; }
        .content-section { display: none; animation: fadeInSection 0.5s ease-out; padding-bottom: 80px; }
        .content-section.active { display: block; }
        @keyframes fadeInSection { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        #pauseIndicator { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: var(--warning-color); color: var(--bg-dark-tertiary); padding: 0.8rem 1.5rem; border-radius: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 2000; display: flex; align-items: center; gap: 0.75rem; font-size: 1rem; font-weight: 600; animation: fadeInPauseIndicator 0.5s ease-out; }
        #pauseIndicator.fade-out { animation: fadeOutPauseIndicator 0.5s ease-in forwards; }
        @keyframes fadeInPauseIndicator { from { opacity: 0; top: -50px; } to { opacity: 1; top: 20px; } }
        @keyframes fadeOutPauseIndicator { from { opacity: 1; top: 20px; } to { opacity: 0; top: -50px; } }
        @media (max-width: 768px) { .auth-container-alphax { padding: 1.5rem; } .auth-title-svg-alphax svg text { font-size: 40px; } .navigation { width: 95%; } .navigation ul li a .icon { font-size: 1.3em; } .navigation ul li.active a .icon { transform: translateY(-15px); } .navigation ul li a .text { bottom: 5px; font-size: 0.7em; } .navigation ul li.active a::after { width: 40%; } .card { margin: 0.5rem; } .popup, .modal { width: 95%; } #pauseIndicator { padding: 0.6rem 1.2rem; font-size: 0.9rem; top: 15px;} }
        /* Added for logout button in settings */
        #logoutButton { margin-top: 1rem; }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-screen active">
        <div class="auth-container-alphax">
            <div class="auth-title-svg-alphax">
                <svg viewBox="0 0 500 100"> <text x="50%" y="50%">ALPHA X AI</text> </svg>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <p class="auth-subtitle-alphax">Login to access the predictor.</p>
                <div>
                    <input type="email" id="loginEmail" class="form-input-alphax" placeholder="Email Address" required>
                </div>
                <div>
                    <input type="password" id="loginPassword" class="form-input-alphax" placeholder="Password" required>
                </div>
                <button type="submit" id="loginButton" class="auth-button-alphax">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </form>

            <!-- Signup Form (Initially Hidden) -->
            <form id="signupForm" class="space-y-4" style="display: none;">
                <p class="auth-subtitle-alphax">Create an account to get started.</p>
                <div>
                    <input type="email" id="signupEmail" class="form-input-alphax" placeholder="Email Address" required>
                </div>
                <div>
                    <input type="password" id="signupPassword" class="form-input-alphax" placeholder="Password (min. 6 characters)" required>
                </div>
                 <div>
                    <input type="password" id="signupConfirmPassword" class="form-input-alphax" placeholder="Confirm Password" required>
                </div>
                <button type="submit" id="signupButton" class="auth-button-alphax">
                    <i class="fas fa-user-plus mr-2"></i>Sign Up
                </button>
            </form>
            
            <div id="authMessage" class="status-message-container-alphax mt-4" style="display: none;"></div>

            <p class="auth-form-toggle">
                <span id="toggleToSignupText">Don't have an account? <button type="button" id="toggleToSignup">Sign Up</button></span>
                <span id="toggleToLoginText" style="display:none;">Already have an account? <button type="button" id="toggleToLogin">Login</button></span>
            </p>
             <p class="auth-footer-link-alphax mt-3">Need help? Contact <a href="https://t.me/ALPHAXAIWEB" target="_blank" rel="noopener noreferrer">Support</a>.</p>
        </div>
    </div>

    <!-- Maintenance Screen -->
    <div id="maintenanceContainer" class="auth-screen">
        <div class="maintenance-card">
            <i class="fas fa-tools"></i>
            <h2 class="text-2xl font-bold mb-2">Under Maintenance</h2>
            <p id="maintenanceMessage" class="text-text-light-secondary">The platform is currently undergoing scheduled maintenance. Please try again later.</p>
        </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="accessDeniedScreen" class="auth-screen">
        <div class="access-denied-card">
            <i class="fas fa-exclamation-triangle"></i>
            <h2 id="accessDeniedTitle">Access Denied</h2>
            <p id="accessDeniedMessage">Your premium access has expired or is not active. Please contact the administrator to renew or activate your subscription.</p>
            <button id="logoutFromDeniedBtn" class="auth-button-alphax w-full mt-6" style="background: var(--skipped-color); color:var(--text-light-primary);">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>
    </div>


    <!-- App Container (Predictor UI) -->
    <div id="appContainer" class="pb-20">
        <div id="badTrendIndicator" class="bad-trend-indicator" style="display: none;">
            <i class="fas fa-shield-alt"></i> <span id="badTrendMessageText">Prediction temporarily disabled - Unstable trend detected</span>
        </div>

        <header id="appHeaderSvgContainer" class="text-center mt-0 mb-2 animate__animated animate__fadeInDown">
            <svg viewBox="0 0 800 120">
                <text x="50%" y="50%">ALPHA X AI</text>
            </svg>
        </header>

        <div class="max-w-full mx-auto p-2 w-full">
            <div class="max-w-4xl mx-auto p-2 w-full">
                <div id="homeSection" class="content-section active">
                    <div class="card mb-4 overflow-hidden gradient-bg animate__animated animate__zoomIn relative">
                        <div class="bg-dark-tertiary bg-opacity-80 p-6 rounded-lg pulse-animation">
                             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"> <div class="relative">
                                    <div class="pl-2">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <i class="fas fa-calendar-alt text-2xl animate__animated animate__bounce text-accent-secondary"></i>
                                            <h2 class="text-2xl font-bold" data-lang-key="period">Period</h2>
                                        </div>
                                        <p id="currentPeriod" class="text-2xl font-semibold p-3 rounded-lg shadow-inner period-id">-</p>
                                    </div>
                                </div>
                                <div class="relative text-right">
                                    <div class="pr-2">
                                        <div class="flex items-center justify-end space-x-2 mb-2">
                                            <h2 class="text-2xl font-bold" data-lang-key="prediction">Prediction</h2>
                                            <i class="fas fa-poll text-2xl animate__animated animate__bounce text-accent-secondary"></i>
                                        </div>
                                        <p id="currentResult" class="text-2xl font-semibold p-3 rounded-lg shadow-inner">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm text-text-light-secondary" data-lang-key="confidence">Confidence</p>
                                <div class="confidence-meter">
                                    <div id="confidenceFill" class="confidence-fill" style="width: 0%"></div>
                                </div>
                                <p id="confidenceText" class="text-sm mt-1 text-text-light-secondary">0%</p>
                            </div>
                        </div>
                        <div class="small-dot" style="top: 15%; left: 15%; animation-delay: 0.2s;"></div>
                        <div class="small-dot" style="top: 25%; left: 75%; animation-delay: 0.5s;"></div>
                        <div class="small-dot" style="top: 65%; left: 25%; animation-delay: 0.8s;"></div>
                        <div class="small-dot" style="top: 80%; left: 85%; animation-delay: 1.1s;"></div>
                        <div class="small-dot" style="top: 50%; left: 5%; animation-delay: 1.4s;"></div>
                        <div class="small-dot" style="top: 5%; left: 50%; animation-delay: 1.7s;"></div>
                    </div>
                    <div class="card mb-4 p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-4 relative text-accent-primary">
                            <span class="relative z-10 pulse-animation" data-lang-key="analysis_dashboard">Analysis Dashboard</span>
                            <span class="absolute top-1/2 left-0 w-full h-1 bg-accent-primary opacity-30 -translate-y-1/2 rounded-full"></span>
                        </h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-star text-lg text-accent-secondary"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="most_frequent_bs">Most Frequent (B/S)</p>
                                        <p id="mostFrequentBigSmall" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-moon text-lg text-accent-secondary"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="least_frequent_bs">Least Frequent (B/S)</p>
                                        <p id="leastFrequentBigSmall" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-chart-line text-lg text-accent-secondary"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="win_rate">Win Rate</p>
                                        <p id="winRate" class="text-xl font-bold text-text-light-primary">-%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.3s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-trophy text-lg text-win-color"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="wins">Wins</p>
                                        <p id="totalWinBets" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.4s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-thumbs-down text-lg text-loss-color"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="losses">Losses</p>
                                        <p id="totalLossBets" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                             <div class="dashboard-card flex items-center justify-between animate__animated animate__fadeIn" style="animation-delay: 0.5s;">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-server text-lg text-accent-secondary"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="server_status">Server Status</p>
                                        <p id="serverStatus" class="font-semibold text-text-light-primary" data-lang-key="connected">Connected</p>
                                    </div>
                                </div>
                                <div id="serverStatusIndicator" class="w-3 h-3 bg-win-color rounded-full animate-ping"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="historySection" class="content-section">
                     <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-3xl font-bold text-center relative text-accent-primary">
                                <span class="relative z-10 pulse-animation" data-lang-key="history">History</span>
                                <span class="absolute top-1/2 left-0 w-full h-1 bg-accent-primary opacity-30 -translate-y-1/2 rounded-full"></span>
                            </h2>
                            <button id="deleteAllHistoryBtn" class="secondary-btn px-4 py-2 rounded-lg transition flex items-center">
                                <i class="fas fa-trash-alt mr-2"></i><span data-lang-key="delete">Delete All</span>
                            </button>
                        </div>
                        <div id="historyContainer" class="history-container">
                            <p class="text-center text-text-light-secondary p-4" data-lang-key="no_history">No history yet.</p>
                        </div>
                    </div>
                </div>
                <div id="statsSection" class="content-section">
                    <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-4 relative text-accent-primary">
                            <span class="relative z-10 pulse-animation" data-lang-key="statistics">Statistics</span>
                             <span class="absolute top-1/2 left-0 w-full h-1 bg-accent-primary opacity-30 -translate-y-1/2 rounded-full"></span>
                        </h2>
                        <div class="stats-grid">
                           <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-trophy text-win-color text-lg"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="total_wins">Total Wins</p>
                                        <p id="statsTotalWins" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-heart-broken text-loss-color text-lg"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="total_losses">Total Losses</p>
                                        <p id="statsTotalLosses" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-percentage text-accent-secondary text-lg"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="win_rate">Win Rate</p>
                                        <p id="statsWinRate" class="text-xl font-bold text-text-light-primary">-%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-fire text-orange-400 text-lg"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="current_streak">Current Streak</p>
                                        <p id="currentStreak" class="text-xl font-bold text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card col-span-full sm:col-span-1 md:col-span-2">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-history text-accent-primary text-lg"></i>
                                    <div>
                                        <p class="text-sm text-text-light-secondary" data-lang-key="last_five_actuals">Last 5 Actuals</p>
                                        <p id="lastFiveActuals" class="text-lg font-mono text-text-light-primary">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="aboutSection" class="content-section">
                     <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-6 relative text-accent-primary">
                            <span class="relative z-10 pulse-animation" data-lang-key="about_aura_x_ai">About ALPHA X AI</span> <span class="absolute top-1/2 left-0 w-full h-1 bg-accent-primary opacity-30 -translate-y-1/2 rounded-full"></span>
                        </h2>
                         <div class="space-y-6 text-text-light-secondary">
                            <div>
                                <h3 class="text-xl font-semibold mb-2 text-accent-primary" data-lang-key="predictor_intro_title">Our Prediction Engine</h3>
                                <p data-lang-key="predictor_intro_p1">ALPHA X AI employs a sophisticated prediction engine, now operating on our secure backend, to analyze trends and patterns from historical data. Our goal is to provide insightful predictions, but it's important to remember that these are based on statistical analysis and not guarantees of future outcomes.</p>
                                <p data-lang-key="predictor_intro_p2_updated">The system uses an advanced multi-model approach, combining numerous analytical techniques to enhance accuracy and adapt to changing conditions. This version incorporates enhanced pattern recognition, transitional analysis, a Relative Strength Index (RSI) engine, a Quantum-Inspired ensemble model, and weighted historical data to provide more nuanced predictions. It also includes the "Omega Mind" protocol, an adaptive risk management system that adjusts prediction confidence and strategy based on recent performance to mitigate prolonged loss streaks and adapt to pattern changes.</p>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-2 text-accent-primary" data-lang-key="how_it_works_title">How It Works (Advanced)</h3>
                                <p class="mb-2">Our prediction logic is now primarily processed on a secure backend server for enhanced performance and security. The core analytical components include:</p>
                                <ul class="list-disc list-inside space-y-1 pl-4">
                                    <li data-lang-key="how_it_works_li1_adv"><strong>Multi-Period Frequency Analysis:</strong> Tracks "BIG" vs "SMALL" occurrences over short, medium, and long-term windows.</li>
                                    <li data-lang-key="how_it_works_li2_adv"><strong>Transition Matrix Analysis:</strong> Calculates probabilities of B->S, S->B, B->B, S->S transitions.</li>
                                    <li data-lang-key="how_it_works_li3_adv"><strong>Advanced Pattern Matching:</strong> Identifies recurring sequences (e.g., BSBS, BBSS, BBSBBS) and alternating trends, adapting to changes in these patterns.</li>
                                    <li data-lang-key="how_it_works_li4_adv"><strong>Streak Dynamics:</strong> Analyzes current and historical win/loss streaks for both outcomes, assessing continuation or reversal likelihood.</li>
                                    <li data-lang-key="how_it_works_li_rsi_engine"><strong>Relative Strength Index (RSI) Trend Engine:</strong> Measures the speed and change of recent numerical outcomes (0-9) to identify potential overbought (suggests SMALL) or oversold (suggests BIG) conditions, contributing to trend assessment.</li>
                                    <li data-lang-key="how_it_works_li_quantum_ai"><strong>Quantum-Inspired AI Ensemble:</strong> A conceptual model that combines outputs from multiple simpler predictors (including deterministic logic like period-based calculations) with varying weights. It may introduce controlled stochasticity or prioritize less obvious patterns, especially when other indicators are conflicting or market volatility is high, simulating a more adaptive and complex decision process.</li>
                                    <li data-lang-key="how_it_works_li_trend_stability"><strong>Trend Stability Analysis:</strong> Evaluates recent win rates and pattern consistency. If the trend is unstable (e.g., low win rate, frequent pattern breaks), the system may suggest skipping predictions or reduce confidence.</li>
                                    <li data-lang-key="how_it_works_li_macd"><strong>Moving Average Convergence Divergence (MACD) Analyzer:</strong> Tracks the relationship between two moving averages of numerical outcomes to identify momentum shifts.</li>
                                    <li data-lang-key="how_it_works_li_bollinger"><strong>Bollinger Bands Analyzer:</strong> Uses standard deviation bands around a moving average to assess volatility and potential overextension.</li>
                                    <li data-lang-key="how_it_works_li_inter_signal"><strong>Inter-Signal Confirmation Engine:</strong> Assesses the level of agreement among various analytical engines (RSI, Quantum, Pattern Matchers, etc.) to adjust overall confidence and resolve conflicting signals.</li>
                                    <li data-lang-key="how_it_works_li_omega_mind"><strong>Omega Mind Protocol (Adaptive Risk Management):</strong>
                                        <ul class="list-['-_'] list-inside pl-4">
                                            <li>Level 0 (Normal): Standard prediction logic with balanced weights for all engines.</li>
                                            <li>Level 1 (Caution - 1 Loss OR Unstable Trend): Slightly reduced confidence, increased sensitivity to counter-signals from RSI or Quantum models.</li>
                                            <li>Level 2 (Warning - 2 Losses OR Persistently Unstable Trend): Significantly reduced confidence, strong bias towards breaking the pattern of the last losing prediction, may favor Quantum or RSI if they suggest a change.</li>
                                            <li>Level 3 (Critical - 3+ Losses OR Very Volatile Market): Prediction might be skipped or use extremely conservative fallback; system focuses on identifying a new stable pattern or preserving capital.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-2 text-accent-primary" data-lang-key="important_note_title">Important Note</h3>
                                <p data-lang-key="important_note_p1">All predictions provided by ALPHA X AI are for informational and entertainment purposes only. Past performance is not indicative of future results. Please use this information responsibly.</p>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-2 text-accent-primary" data-lang-key="meet_the_team_title">Meet The Team</h3>
                                <p data-lang-key="owner_info"><strong>Owner/Developer:</strong> @ALPHAXAIWEB</p>
                                <a href="https://t.me/ALPHAXAIWEB" target="_blank" rel="noopener noreferrer" class="inline-block mt-1 px-4 py-2 primary-btn text-sm rounded-lg">
                                    <i class="fab fa-telegram-plane mr-2"></i><span data-lang-key="owner_telegram">Telegram Profile</span>
                                </a>
                            </div>
                            <hr class="border-card-border-color my-6">
                            
                            <div class="settings-group">
                                <h3 class="settings-group-title" data-lang-key="general_settings_title">General Settings</h3>
                                <div class="space-y-2"> <div class="mode-toggle">
                                        <label for="languageToggle" data-lang-key="language">Language</label>
                                        <div class="flex items-center">
                                            <span class="mode-icons mr-2"><span>EN</span></span>
                                            <label class="mode-switch">
                                                <input type="checkbox" id="languageToggle">
                                                <span class="mode-slider"></span>
                                            </label>
                                            <span class="mode-icons ml-2"><span>HI</span></span>
                                        </div>
                                    </div>
                                    <div class="mode-toggle">
                                        <label for="notificationToggle" data-lang-key="notifications">Notifications</label>
                                        <div class="flex items-center">
                                            <span class="mode-icons mr-2"><i class="fas fa-bell-slash"></i></span>
                                            <label class="mode-switch">
                                                <input type="checkbox" id="notificationToggle">
                                                <span class="mode-slider"></span>
                                            </label>
                                            <span class="mode-icons ml-2"><i class="fas fa-bell"></i></span>
                                        </div>
                                    </div>
                                    <div class="mode-toggle">
                                        <label for="soundToggle" data-lang-key="sound">Sound</label>
                                        <div class="flex items-center">
                                            <span class="mode-icons mr-2"><i class="fas fa-volume-mute"></i></span>
                                            <label class="mode-switch">
                                                <input type="checkbox" id="soundToggle">
                                                <span class="mode-slider"></span>
                                            </label>
                                            <span class="mode-icons ml-2"><i class="fas fa-volume-up"></i></span>
                                        </div>
                                    </div>
                                    <!-- Prediction Mode Toggle Removed - Logic is now backend-driven -->
                                </div>
                            </div>
                             <button id="resetSettingsBtn" class="w-full secondary-btn mt-4" onclick="alphaX_resetSettings()">
                                <i class="fas fa-undo mr-2"></i><span data-lang-key="reset_settings">Reset Settings</span>
                            </button>
                             <button id="logoutButton" class="w-full auth-button-alphax mt-4" style="background: var(--loss-color); color:var(--text-light-primary);">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </button>
                            <hr class="border-card-border-color my-6">
                            <div>
                                <h3 class="text-xl font-semibold mb-3 text-accent-primary" data-lang-key="more_info_title">More Information</h3>
                                <div class="space-y-3">
                                    <button class="w-full secondary-btn" onclick="alphaX_openVideoPopup()">
                                        <i class="fas fa-play-circle mr-2"></i><span data-lang-key="how_to_use">How To Use</span> (<span data-lang-key="watch_video">Watch Video</span>)
                                    </button>
                                </div>
                            </div>
                         </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <ul>
                <li class="active">
                    <a href="#" data-section="homeSection">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="text" data-lang-key="home">Home</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="historySection">
                        <span class="icon"><ion-icon name="time-outline"></ion-icon></span>
                        <span class="text" data-lang-key="history">History</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="statsSection">
                        <span class="icon"><ion-icon name="bar-chart-outline"></ion-icon></span>
                        <span class="text" data-lang-key="stats">Stats</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="aboutSection">
                        <span class="icon"><ion-icon name="information-circle-outline"></ion-icon></span>
                        <span class="text" data-lang-key="about">About</span>
                    </a>
                </li>
                </ul>
        </div>

        <div id="videoPopup" class="popup">
            <h3 data-lang-key="how_to_use_aura_x_ai">How To Use ALPHA X AI</h3>
            <div class="video-container">
                <iframe id="youtubeVideo" width="560" height="315" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="button-group mt-4">
                <button class="secondary-btn" onclick="alphaX_closeVideoPopup()"><i class="fas fa-times mr-2"></i><span data-lang-key="cancel">Close</span></button>
            </div>
        </div>

        <div id="confirmModal" class="modal">
            <h3 data-lang-key="confirm_action">Confirm Action</h3>
            <p id="modalMessage">Are you sure?</p>
            <div class="button-group">
                <button id="cancelModalBtn" class="secondary-btn"><i class="fas fa-times mr-2"></i><span data-lang-key="cancel">Cancel</span></button>
                <button id="confirmModalBtn" class="primary-btn"><i class="fas fa-check mr-2"></i><span data-lang-key="confirm">Confirm</span></button>
            </div>
        </div>

        <div id="streakBreakPopup" class="popup"> <h3><i class="fas fa-fire-alt text-orange-400 mr-2"></i><span data-lang-key="streak_alert">Win Streak Alert!</span></h3>
            <p id="streakBreakMessage">You're on a 7-win streak! Consider taking a break?</p>
            <div class="button-group">
                <button id="cancelStreakModalBtn" class="secondary-btn"><i class="fas fa-play mr-2"></i><span data-lang-key="continue_predicting">Keep Going</span></button>
                <button class="primary-btn" onclick="alphaX_pausePredictionsUserInitiated(30)"><i class="fas fa-pause mr-2"></i><span data-lang-key="pause_predictions">Pause (30min)</span></button>
            </div>
        </div>

        <div id="badTrendPopup" class="popup"> <h3><i class="fas fa-exclamation-triangle text-warning-color mr-2"></i><span data-lang-key="trend_alert">Trend Alert!</span></h3>
            <p id="badTrendPopupMessageEl">Unstable trend detected. Prediction accuracy might be affected.</p>
            <div class="button-group">
                <button id="cancelBadTrendModalBtn" class="secondary-btn"><i class="fas fa-play mr-2"></i><span data-lang-key="continue_predicting_anyway">Continue Anyway</span></button>
                <button class="danger-btn" onclick="alphaX_disablePredictionsUserInitiated(60)"><i class="fas fa-stop-circle mr-2"></i><span data-lang-key="disable_predictions">Disable (1hr)</span></button>
            </div>
        </div>
    </div>

    <div id="loginToast" class="toast-login" style="display: none;">
        <span class="icon"></span>
        <p id="loginToastMessage" class="text-base"></p>
    </div>

    <script type="module">
        // Firebase SDK imports (modular v9+)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            getIdToken // For sending to backend
        } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            set, 
            get, 
            // child, // Not directly used, ref() is preferred
            onValue, 
            serverTimestamp, 
            // push, // Backend will handle push to history
            query, 
            orderByChild, 
            limitToLast,
            remove
            // update // Not directly used, set() with merge or specific paths is often used
        } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // --- Firebase Configuration ---
        const firebaseConfig = { // Using the user-provided config from the previous turn
            apiKey: "AIzaSyBGJtGnfdDw2rPpJLphbRisWz0MXLvIEyI",
            authDomain: "premiumalphaxai.firebaseapp.com",
            projectId: "premiumalphaxai",
            storageBucket: "premiumalphaxai.appspot.com", 
            messagingSenderId: "603060693272",
            appId: "1:603060693272:web:14305c2c1142f46737966d",
            measurementId: "G-GLVNVE4LES",
            databaseURL: "https://premiumalphaxai-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        console.log("Firebase initialized (Frontend).");

        // --- CONFIGURATION ---
        const BACKEND_URL = "https://3ee8fe32-bfee-4aea-accf-471a67337aa7-00-31cquvnv92zbr.pike.replit.dev/"; 
        const PREDICTION_ENDPOINT = `${BACKEND_URL}predict`; // Ensure no double slash if BACKEND_URL ends with /
        // const FETCH_GAME_RESULT_ENDPOINT = `${BACKEND_URL}fetchGameResult`; // Not directly called by frontend anymore

        // Firebase Paths (mostly read by frontend, written by backend)
        const USER_PREMIUM_ACCESS_PATH = "user_premium_access";
        const SHARED_GAME_HISTORY_PATH = "shared_alpha_x_ai/game_history";
        const SHARED_CURRENT_PREDICTION_PATH = "shared_alpha_x_ai/current_prediction";
        const MAINTENANCE_STATUS_PATH = "alphax_maintenanceStatus";
        const MAX_SHARED_HISTORY_LENGTH = 50;

        // --- Auth State & UI Elements ---
        const authScreen = document.getElementById('authScreen');
        const appContainer = document.getElementById('appContainer');
        const maintenanceContainer = document.getElementById('maintenanceContainer');
        const accessDeniedScreen = document.getElementById('accessDeniedScreen');
        
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const loginEmailInput = document.getElementById('loginEmail');
        const loginPasswordInput = document.getElementById('loginPassword');
        const loginButton = document.getElementById('loginButton');
        const signupEmailInput = document.getElementById('signupEmail');
        const signupPasswordInput = document.getElementById('signupPassword');
        const signupConfirmPasswordInput = document.getElementById('signupConfirmPassword');
        const signupButton = document.getElementById('signupButton');
        const authMessageDiv = document.getElementById('authMessage');
        const toggleToSignupButton = document.getElementById('toggleToSignup');
        const toggleToLoginButton = document.getElementById('toggleToLogin');
        const toggleToSignupText = document.getElementById('toggleToSignupText');
        const toggleToLoginText = document.getElementById('toggleToLoginText');
        const logoutButton = document.getElementById('logoutButton');
        const logoutFromDeniedBtn = document.getElementById('logoutFromDeniedBtn');


        let currentUser = null;
        let premiumAccessListener = null; 
        let predictionIntervalId = null;


        // --- Global Settings State ---
        let alphaX_currentLanguage = localStorage.getItem('alphaXAiLanguage') || 'en';
        let alphaX_isSoundEnabled = localStorage.getItem('alphaXAiSound') === null ? true : localStorage.getItem('alphaXAiSound') === 'true';
        let alphaX_isNotificationsEnabled = localStorage.getItem('alphaXAiNotifications') === 'true' || false;
        let isMuted = !alphaX_isSoundEnabled; 

        // --- Translations (Updated for backend logic) ---
        const translations = {
            en: { 
                period: "Period", prediction: "Prediction", confidence: "Confidence",
                analysis_dashboard: "Analysis Dashboard", most_frequent_bs: "Most Frequent (B/S)",
                least_frequent_bs: "Least Frequent (B/S)", win_rate: "Win Rate", wins: "Wins", losses: "Losses",
                server_status: "Server Status", connected: "Connected", disconnected: "Disconnected", under_maintenance: "Under Maintenance",
                history: "History", delete: "Delete All", statistics: "Statistics", total_wins: "Total Wins",
                total_losses: "Total Losses", current_streak: "Current Streak", last_five_actuals: "Last 5 Actuals",
                about: "About", home: "Home", stats: "Stats",
                about_aura_x_ai: "About ALPHA X AI",
                predictor_intro_title: "Our Prediction Engine",
                predictor_intro_p1: "ALPHA X AI employs a sophisticated prediction engine, now operating on our secure backend, to analyze trends and patterns from historical data. Our goal is to provide insightful predictions, but it's important to remember that these are based on statistical analysis and not guarantees of future outcomes.",
                predictor_intro_p2_updated: "The system uses an advanced multi-model approach, combining numerous analytical techniques to enhance accuracy and adapt to changing conditions. This version incorporates enhanced pattern recognition, transitional analysis, a Relative Strength Index (RSI) engine, a Quantum-Inspired ensemble model, and weighted historical data to provide more nuanced predictions. It also includes the \"Omega Mind\" protocol, an adaptive risk management system that adjusts prediction confidence and strategy based on recent performance to mitigate prolonged loss streaks and adapt to pattern changes.",
                how_it_works_title: "How It Works (Advanced)",
                how_it_works_li1_adv: "<strong>Multi-Period Frequency Analysis:</strong> Tracks \"BIG\" vs \"SMALL\" occurrences over short, medium, and long-term windows.",
                how_it_works_li2_adv: "<strong>Transition Matrix Analysis:</strong> Calculates probabilities of B->S, S->B, B->B, S->S transitions.",
                how_it_works_li3_adv: "<strong>Advanced Pattern Matching:</strong> Identifies recurring sequences (e.g., BSBS, BBSS, BBSBBS) and alternating trends, adapting to changes in these patterns.",
                how_it_works_li4_adv: "<strong>Streak Dynamics:</strong> Analyzes current and historical win/loss streaks for both outcomes, assessing continuation or reversal likelihood.",
                how_it_works_li_rsi_engine: "<strong>Relative Strength Index (RSI) Trend Engine:</strong> Measures the speed and change of recent numerical outcomes (0-9) to identify potential overbought (suggests SMALL) or oversold (suggests BIG) conditions, contributing to trend assessment.",
                how_it_works_li_quantum_ai: "<strong>Quantum-Inspired AI Ensemble:</strong> A conceptual model that combines outputs from multiple simpler predictors (including deterministic logic like period-based calculations) with varying weights. It may introduce controlled stochasticity or prioritize less obvious patterns, especially when other indicators are conflicting or market volatility is high, simulating a more adaptive and complex decision process.",
                how_it_works_li_trend_stability: "<strong>Trend Stability Analysis:</strong> Evaluates recent win rates and pattern consistency. If the trend is unstable (e.g., low win rate, frequent pattern breaks), the system may suggest skipping predictions or reduce confidence.",
                how_it_works_li_macd: "<strong>Moving Average Convergence Divergence (MACD) Analyzer:</strong> Tracks the relationship between two moving averages of numerical outcomes to identify momentum shifts.",
                how_it_works_li_bollinger: "<strong>Bollinger Bands Analyzer:</strong> Uses standard deviation bands around a moving average to assess volatility and potential overextension.",
                how_it_works_li_inter_signal: "<strong>Inter-Signal Confirmation Engine:</strong> Assesses the level of agreement among various analytical engines (RSI, Quantum, Pattern Matchers, etc.) to adjust overall confidence and resolve conflicting signals.",
                how_it_works_li_omega_mind: "<strong>Omega Mind Protocol (Adaptive Risk Management):</strong><ul><li>Level 0 (Normal): Standard prediction logic with balanced weights for all engines.</li><li>Level 1 (Caution - 1 Loss OR Unstable Trend): Slightly reduced confidence, increased sensitivity to counter-signals from RSI or Quantum models.</li><li>Level 2 (Warning - 2 Losses OR Persistently Unstable Trend): Significantly reduced confidence, strong bias towards breaking the pattern of the last losing prediction, may favor Quantum or RSI if they suggest a change.</li><li>Level 3 (Critical - 3+ Losses OR Very Volatile Market): Prediction might be skipped or use extremely conservative fallback; system focuses on identifying a new stable pattern or preserving capital.</li></ul>",
                important_note_title: "Important Note",
                important_note_p1: "All predictions provided by ALPHA X AI are for informational and entertainment purposes only. Past performance is not indicative of future results. Please use this information responsibly.",
                meet_the_team_title: "Meet The Team", owner_info: "<strong>Owner/Developer:</strong> @ALPHAXAIWEB", owner_telegram: "Telegram Profile",
                general_settings_title: "General Settings", more_info_title: "More Information", status: "Status",
                language: "Language", notifications: "Notifications", sound: "Sound", reset_settings: "Reset Settings",
                reset: "Reset", // prediction_mode: "Prediction Mode", // Removed
                how_to_use: "How To Use", watch_video: "Watch Video",
                privacy_policy: "Privacy Policy", read_more: "Read More", how_to_use_aura_x_ai: "How To Use ALPHA X AI",
                confirm_action: "Confirm Action", cancel: "Cancel", confirm: "Confirm", pending: "Pending",
                win: "Win", loss: "Loss", delete_item_confirm: "Are you sure you want to delete this history item?",
                delete_all_confirm: "Are you sure you want to delete all history items?",
                reset_settings_confirm: "Are you sure you want to reset all settings to default?",
                api_error: "API Error. Please try again later.", fetching_data: "Fetching data...",
                streak_alert: "Win Streak Alert", trend_alert: "Trend Alert", pause_predictions: "Pause Predictions",
                disable_predictions: "Disable Predictions", continue_predicting: "Keep Going", continue_predicting_anyway: "Continue Anyway",
                predictions_paused_user: "Predictions Paused by User", predictions_resuming_in: "Resuming in",
                predictions_disabled_auto: "Predictions Auto-Disabled (Omega Protocol L3)",
                resume_predictions: "Resume Predictions",
                unstable_trend_detected: "Unstable trend detected - Predictions temporarily disabled",
                bad_trend_message: "The current trend analysis shows unstable patterns. Predictions are temporarily disabled to protect against potential losses.",
                trend_will_auto_resume: "Predictions will automatically resume when the trend stabilizes or timer ends.",
                no_history: "No history yet.",
                omega_level_0: "Omega Protocol: Level 0 (Normal Operations)",
                omega_level_1: "Omega Protocol: Level 1 (Caution Mode)",
                omega_level_2: "Omega Protocol: Level 2 (Warning Mode - High Risk)",
                omega_level_3: "Omega Protocol: Level 3 (Critical - Predictions Disabled)",
                access_denied_title: "Access Denied",
                access_expired_message: "Your premium access has expired. Please contact the administrator to renew your subscription.",
                access_not_active_message: "Your premium access is not active or pending approval. Please contact the administrator.",
                access_pending_message: "Your premium access is pending approval. Please wait or contact the administrator.",
                logged_out_successfully: "Logged out successfully.",
                login_successful: "Login successful! Welcome back.",
                signup_successful_pending: "Signup successful! Your account is created. Please contact admin for premium access activation.",
                password_mismatch: "Passwords do not match.",
                password_too_short: "Password should be at least 6 characters.",
                contact_admin_for_access: "Please contact the administrator for access.",
                backend_error: "Error communicating with the prediction server. Please try again later.",
                fetching_prediction: "Fetching prediction from server..."
            },
            hi: { 
                period: "", prediction: "", confidence: "",
                analysis_dashboard: " ", most_frequent_bs: "  (/)",
                least_frequent_bs: "    (/)", win_rate: " ", wins: "", losses: "",
                server_status: " ", connected: " ", disconnected: "  ", under_maintenance: "  ",
                history: "", delete: "  ", statistics: "", total_wins: " ",
                total_losses: " ", current_streak: " ", last_five_actuals: " 5 ",
                about: "", home: "", stats: "",
                about_aura_x_ai: "     ",
                predictor_intro_title: "  ",
                predictor_intro_p1: "          ,         ,                   ,                     ",
                predictor_intro_p2_updated: "         -     ,                             ,  ,     (RSI) ,  -            \" \"    ,                                           ",
                how_it_works_title: "     ()",
                how_it_works_li1_adv: "<strong>-  :</strong> ,        \"\"  \"\"     ",
                how_it_works_li2_adv: "<strong>  :</strong> B->S, S->B, B->B, S->S       ",
                how_it_works_li3_adv: "<strong>  :</strong>   (, BSBS, BBSS, BBSBBS)       ,        ",
                how_it_works_li4_adv: "<strong> :</strong>        /      ,         ",
                how_it_works_li_rsi_engine: "<strong>   (RSI)  :</strong>    (0-9)           (SMALL  )   (BIG  )      ,       ",
                how_it_works_li_quantum_ai: "<strong>- AI :</strong>        (-     )                          ,             ,           ",
                how_it_works_li_trend_stability: "<strong>  :</strong>                (  ,   ,   ),              ",
                how_it_works_li_macd: "<strong>    (MACD) :</strong>            ING        ",
                how_it_works_li_bollinger: "<strong>  :</strong>                    ",
                how_it_works_li_inter_signal: "<strong>-  :</strong>                  (RSI, ,  , )         ",
                how_it_works_li_omega_mind: "<strong>   (  ):</strong><ul><li> 0 ():           </li><li> 1 ( - 1  OR Unstable Trend):   , RSI     -     </li><li> 2 ( - 2  OR Persistently Unstable Trend):   ,           ,           RSI     </li><li> 3 ( - 3+  OR Very Volatile Market):     ,     (,  - RSI ,  )    ;                </li></ul>",
                important_note_title: " ",
                important_note_p1: "                                 ",
                meet_the_team_title: "  ", owner_info: "<strong>/:</strong> @ALPHAXAIWEB", owner_telegram: " ",
                general_settings_title: " ", more_info_title: " ", status: "",
                language: "", notifications: "", sound: "", reset_settings: "  ",
                reset: "", // prediction_mode: " ", // Removed
                how_to_use: "  ", watch_video: " ",
                privacy_policy: " ", read_more: " ", how_to_use_aura_x_ai: "      ",
                confirm_action: "   ", cancel: " ", confirm: " ", pending: "",
                win: "", loss: "", delete_item_confirm: "           ?",
                delete_all_confirm: "          ?",
                reset_settings_confirm: "             ?",
                api_error: "     :  ", fetching_data: "     ...",
                streak_alert: "   ", trend_alert: " ", pause_predictions: " ",
                disable_predictions: "  ", continue_predicting: " ", continue_predicting_anyway: "   ",
                predictions_paused_user: "    ", predictions_resuming_in: "      ",
                predictions_disabled_auto: "   (  L3)",
                resume_predictions: "    ",
                unstable_trend_detected: "     -      ",
                bad_trend_message: "                     ",
                trend_will_auto_resume: "                 ",
                no_history: "     ",
                omega_level_0: " :  0 ( )",
                omega_level_1: " :  1 ( )",
                omega_level_2: " :  2 (  -  )",
                omega_level_3: " :  3 ( -  )",
                access_denied_title: " ",
                access_expired_message: "                  ",
                access_not_active_message: "                ",
                access_pending_message: "               ",
                logged_out_successfully: "    ",
                login_successful: " !   ",
                signup_successful_pending: " !               ",
                password_mismatch: "   ",
                password_too_short: "    6    ",
                contact_admin_for_access: "       ",
                backend_error: "          :  ",
                fetching_prediction: "       ..."
            }
        };
        
        // --- DOM Elements (Predictor UI) ---
        const alphaX_currentPeriodEl = document.getElementById('currentPeriod');
        const alphaX_currentResultEl = document.getElementById('currentResult'); 
        const alphaX_confidenceFillEl = document.getElementById('confidenceFill');
        const alphaX_confidenceTextEl = document.getElementById('confidenceText');
        const alphaX_mostFrequentBigSmallEl = document.getElementById('mostFrequentBigSmall');
        const alphaX_leastFrequentBigSmallEl = document.getElementById('leastFrequentBigSmall');
        const alphaX_winRateEl = document.getElementById('winRate'); 
        const alphaX_totalWinBetsEl = document.getElementById('totalWinBets'); 
        const alphaX_totalLossBetsEl = document.getElementById('totalLossBets'); 
        const alphaX_serverStatusEl = document.getElementById('serverStatus');
        const alphaX_serverStatusIndicator = document.getElementById('serverStatusIndicator');
        const alphaX_historyContainer = document.getElementById('historyContainer'); 
        const alphaX_statsTotalWinsEl = document.getElementById('statsTotalWins'); 
        const alphaX_statsTotalLossesEl = document.getElementById('statsTotalLosses'); 
        const alphaX_statsWinRateEl = document.getElementById('statsWinRate'); 
        const alphaX_currentStreakEl = document.getElementById('currentStreak');
        const alphaX_lastFiveActualsEl = document.getElementById('lastFiveActuals');
        const alphaX_videoPopupEl = document.getElementById('videoPopup');
        const alphaX_youtubeVideoEl = document.getElementById('youtubeVideo');
        const alphaX_confirmModalEl = document.getElementById('confirmModal');
        const alphaX_modalMessageEl = document.getElementById('modalMessage');
        const alphaX_streakBreakPopupEl = document.getElementById('streakBreakPopup');
        // const alphaX_streakBreakMessageEl = document.getElementById('streakBreakMessage'); // Already defined
        const alphaX_badTrendIndicatorEl = document.getElementById('badTrendIndicator');
        const alphaX_badTrendMessageTextEl = document.getElementById('badTrendMessageText'); 
        const alphaX_badTrendPopupEl = document.getElementById('badTrendPopup');
        const alphaX_badTrendPopupMessageEl = document.getElementById('badTrendPopupMessageEl'); 

        // --- Utility Functions ---
        function showAuthMessage(message, type = 'info') {
            if (!authMessageDiv) return;
            authMessageDiv.textContent = message;
            authMessageDiv.className = 'status-message-container-alphax mt-4'; 
            if (type === 'error') authMessageDiv.classList.add('error');
            else if (type === 'success') authMessageDiv.classList.add('success');
            else authMessageDiv.classList.add('info');
            authMessageDiv.style.display = 'flex';
        }

        function clearAuthMessage() {
            if (authMessageDiv) {
                authMessageDiv.style.display = 'none';
                authMessageDiv.textContent = '';
            }
        }

        function showScreen(screenElement) {
            authScreen.classList.remove('active');
            appContainer.classList.remove('active');
            maintenanceContainer.classList.remove('active');
            accessDeniedScreen.classList.remove('active');

            if (screenElement) {
                screenElement.classList.add('active');
                gsap.fromTo(screenElement, {opacity: 0, y: 15}, {opacity: 1, y: 0, duration: 0.4, ease: "power2.out"});
            }
            if (screenElement === appContainer) {
                document.body.style.justifyContent = 'flex-start';
                document.body.style.alignItems = 'stretch';
            } else {
                document.body.style.justifyContent = 'center';
                document.body.style.alignItems = 'center';
            }
        }
        
        // --- Authentication Logic ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearAuthMessage();
            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;
            loginButton.disabled = true;
            loginButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Logging in...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error("Login error:", error);
                showAuthMessage(error.message, 'error');
            } finally {
                loginButton.disabled = false;
                loginButton.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Login';
            }
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearAuthMessage();
            const email = signupEmailInput.value;
            const password = signupPasswordInput.value;
            const confirmPassword = signupConfirmPasswordInput.value;

            if (password !== confirmPassword) {
                showAuthMessage(translations[alphaX_currentLanguage]?.password_mismatch || "Passwords do not match.", 'error');
                return;
            }
            if (password.length < 6) {
                showAuthMessage(translations[alphaX_currentLanguage]?.password_too_short || "Password should be at least 6 characters.", 'error');
                return;
            }

            signupButton.disabled = true;
            signupButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Signing up...';

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showAuthMessage(translations[alphaX_currentLanguage]?.signup_successful_pending || "Signup successful! Account created. Contact admin for premium access.", 'success');
                setTimeout(() => {
                    loginForm.style.display = 'block';
                    signupForm.style.display = 'none';
                    toggleToSignupText.style.display = 'block';
                    toggleToLoginText.style.display = 'none';
                    loginEmailInput.value = email; 
                    loginPasswordInput.value = '';
                }, 2000);

            } catch (error) {
                console.error("Signup error:", error);
                showAuthMessage(error.message, 'error');
            } finally {
                signupButton.disabled = false;
                signupButton.innerHTML = '<i class="fas fa-user-plus mr-2"></i>Sign Up';
            }
        });

        toggleToSignupButton.addEventListener('click', () => {
            clearAuthMessage();
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            toggleToSignupText.style.display = 'none';
            toggleToLoginText.style.display = 'block';
        });

        toggleToLoginButton.addEventListener('click', () => {
            clearAuthMessage();
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            toggleToSignupText.style.display = 'block';
            toggleToLoginText.style.display = 'none';
        });
        
        async function handleLogout() {
            try {
                await signOut(auth);
                alphaX_showLoginToast(translations[alphaX_currentLanguage]?.logged_out_successfully || "Logged out successfully.", 'info');
            } catch (error) {
                console.error("Logout error:", error);
                showAuthMessage("Error logging out: " + error.message, 'error');
            }
        }
        logoutButton.addEventListener('click', handleLogout);
        logoutFromDeniedBtn.addEventListener('click', handleLogout);

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (premiumAccessListener) { 
                premiumAccessListener(); 
                premiumAccessListener = null;
            }
            if (predictionIntervalId) {
                clearInterval(predictionIntervalId);
                predictionIntervalId = null;
            }

            if (user) {
                console.log("User logged in:", user.uid, user.email);
                checkMaintenanceAndAccess(user);
            } else {
                console.log("User logged out or not authenticated.");
                showScreen(authScreen);
                if(alphaX_currentPeriodEl) alphaX_currentPeriodEl.textContent = '-';
                if(alphaX_currentResultEl) alphaX_currentResultEl.textContent = '-';
            }
        });

        async function checkMaintenanceAndAccess(user) {
            try {
                const maintenanceSnapshot = await get(ref(db, MAINTENANCE_STATUS_PATH));
                const maintenanceData = maintenanceSnapshot.val();
                if (maintenanceData && maintenanceData.status === true) {
                    const msg = maintenanceData.message || translations[alphaX_currentLanguage]?.under_maintenance || "The platform is currently under maintenance. Please try again later.";
                    document.getElementById('maintenanceMessage').textContent = msg;
                    showScreen(maintenanceContainer);
                    return;
                }
                checkPremiumAccess(user);

            } catch (error) {
                console.error("Error checking maintenance/access status:", error);
                showAuthMessage("Error checking server status. Please try again.", "error");
                showScreen(authScreen); 
            }
        }
        
        function checkPremiumAccess(user) {
            const userAccessRef = ref(db, `${USER_PREMIUM_ACCESS_PATH}/${user.uid}`);
            
            if (premiumAccessListener) premiumAccessListener(); 

            premiumAccessListener = onValue(userAccessRef, (snapshot) => {
                if (!auth.currentUser || auth.currentUser.uid !== user.uid) {
                    if (premiumAccessListener) premiumAccessListener();
                    return;
                }

                const accessData = snapshot.val();
                const accessDeniedTitleEl = document.getElementById('accessDeniedTitle');
                const accessDeniedMessageEl = document.getElementById('accessDeniedMessage');

                if (accessData && accessData.status === 'active' && accessData.expiryTimestamp > Date.now()) {
                    showScreen(appContainer);
                    initializeAppPredictor(); 
                } else {
                    if (predictionIntervalId) { clearInterval(predictionIntervalId); predictionIntervalId = null; }
                    console.log("Premium access denied or expired for user:", user.uid, accessData);
                    let title = translations[alphaX_currentLanguage]?.access_denied_title || "Access Denied";
                    let message = translations[alphaX_currentLanguage]?.access_not_active_message || "Your premium access is not active. Please contact the administrator.";

                    if (accessData) {
                        if (accessData.status === 'pending_approval') {
                            title = translations[alphaX_currentLanguage]?.pending || "Access Pending";
                            message = translations[alphaX_currentLanguage]?.access_pending_message || "Your premium access is pending approval. Please wait or contact the administrator.";
                        } else if (accessData.expiryTimestamp <= Date.now()) {
                            message = translations[alphaX_currentLanguage]?.access_expired_message || "Your premium access has expired. Please contact the administrator to renew your subscription.";
                        }
                    } else { // No accessData means user is in Auth but not in user_premium_access
                         message = translations[alphaX_currentLanguage]?.contact_admin_for_access || "Please contact the administrator for access.";
                    }
                    if(accessDeniedTitleEl) accessDeniedTitleEl.textContent = title;
                    if(accessDeniedMessageEl) accessDeniedMessageEl.textContent = message;
                    showScreen(accessDeniedScreen);
                }
            }, (error) => {
                console.error("Error fetching premium access:", error);
                if (predictionIntervalId) { clearInterval(predictionIntervalId); predictionIntervalId = null; }
                showAuthMessage("Error checking premium access: " + error.message, 'error');
                showScreen(authScreen); 
            });
        }

        // --- Frontend logic to call backend for predictions ---
        let localHistoryData = []; 
        let globalPredictionData = null; // Data from SHARED_CURRENT_PREDICTION_PATH (set by backend)
        let isFetchingPrediction = false;


        async function triggerBackendPredictionCycle() {
            if (isFetchingPrediction) {
                console.log("Prediction fetch already in progress.");
                return;
            }
            if (!currentUser) {
                console.log("No user logged in, skipping backend prediction trigger.");
                return;
            }
            if (BACKEND_URL === "YOUR_REPLIT_BACKEND_URL_HERE" || !BACKEND_URL.startsWith("https://")) {
                console.warn("Backend URL not configured or invalid. Please set BACKEND_URL correctly.");
                alphaX_showLoginToast("Backend not configured.", "error");
                alphaX_updateServerStatusUI(false, "Backend Not Configured");
                return;
            }

            isFetchingPrediction = true;
            console.log("Triggering backend prediction cycle...");
            alphaX_updateServerStatusUI(true, translations[alphaX_currentLanguage]?.fetching_prediction || "Fetching prediction...");

            try {
                const idToken = await getIdToken(currentUser, /* forceRefresh */ true);
                const response = await fetch(PREDICTION_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(`Backend error: ${response.status} - ${errorData.message || 'Unknown error'}`);
                }
                
                const result = await response.json();
                console.log("Prediction cycle triggered on backend. Result:", result);
                alphaX_updateServerStatusUI(true, translations[alphaX_currentLanguage]?.connected || "Connected");

            } catch (error) {
                console.error("Error triggering backend prediction cycle:", error);
                alphaX_showLoginToast(translations[alphaX_currentLanguage]?.backend_error || "Error communicating with server.", "error");
                alphaX_updateServerStatusUI(false, `Backend Error`); // Simplified error for UI
            } finally {
                isFetchingPrediction = false;
            }
        }
        
        function setupFirebaseListeners() {
            onValue(ref(db, SHARED_CURRENT_PREDICTION_PATH), (snapshot) => {
                const currentPredData = snapshot.val();
                globalPredictionData = currentPredData; 
                if (currentPredData) {
                    if(alphaX_currentPeriodEl) alphaX_currentPeriodEl.textContent = currentPredData.periodDisplay || currentPredData.periodFull?.slice(-5) || '-';
                    if(alphaX_currentResultEl) alphaX_currentResultEl.textContent = currentPredData.prediction || '-';
                    if(alphaX_confidenceTextEl) alphaX_confidenceTextEl.textContent = `${currentPredData.confidence || 0}%`;
                    if(alphaX_confidenceFillEl) alphaX_confidenceFillEl.style.width = `${currentPredData.confidence || 0}%`;
                } else {
                    if(alphaX_currentPeriodEl) alphaX_currentPeriodEl.textContent = '-';
                    if(alphaX_currentResultEl) alphaX_currentResultEl.textContent = '-';
                    if(alphaX_confidenceTextEl) alphaX_confidenceTextEl.textContent = `0%`;
                    if(alphaX_confidenceFillEl) alphaX_confidenceFillEl.style.width = `0%`;
                }
                updateHistoryUI_V2(); 
            });

            const historyQuery = query(ref(db, SHARED_GAME_HISTORY_PATH), orderByChild("timestamp"), limitToLast(MAX_SHARED_HISTORY_LENGTH));
            onValue(historyQuery, (snapshot) => {
                const newHistory = [];
                if (snapshot.exists()) {
                    snapshot.forEach(childSnapshot => {
                        newHistory.unshift({ id: childSnapshot.key, ...childSnapshot.val() }); 
                    });
                }
                localHistoryData = newHistory; 
                updateHistoryUI_V2(); 
                updateStatsUI_V2();   
            });
        }

        function updateHistoryUI_V2() {
            const container = document.getElementById("historyContainer");
            if (!container) return;

            let resolvedHistoryHtml = "";
            if (localHistoryData.length > 0) {
                 resolvedHistoryHtml = localHistoryData.map((item, index) => {
                    const itemStatus = item.status || "Pending"; 
                    const itemPrediction = item.prediction || "-";
                    let iconClass = "fas fa-clock text-yellow-500"; 
                    let statusBgClass = "history-status-icon-bg.pending";
                    let animationClass = itemStatus === "Pending" ? "animate-spin" : "";

                    if (itemStatus === 'WIN') { 
                        iconClass = `fas fa-trophy history-status-icon win`; 
                        statusBgClass = "history-status-icon-bg win";
                    } else if (itemStatus === 'LOSS') { 
                        iconClass = `fas fa-skull history-status-icon loss`; 
                        statusBgClass = "history-status-icon-bg loss";
                    } else if (itemStatus === 'Skipped') { 
                        iconClass = `fas fa-forward history-status-icon skipped`; 
                        statusBgClass = "history-status-icon-bg skipped";
                    } else if (itemStatus === 'Pending') {
                        iconClass = `fas fa-hourglass-half history-status-icon pending animate-spin`;
                        statusBgClass = "history-status-icon-bg pending";
                    }

                    return `
                    <div class="history-item ${itemStatus.toLowerCase()} bg-[var(--bg-dark-secondary)] p-3 md:p-4 rounded-xl border border-[var(--card-border-color)] flex flex-col md:flex-row justify-between items-start md:items-center animate-bounceIn" 
                         data-id="${item.id}" 
                         style="animation-delay: ${index * 0.05}s;">
                      <div class="flex items-center space-x-2 md:space-x-3 mb-2 md:mb-0 flex-grow">
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-[var(--accent-secondary)] bg-opacity-20 rounded-full flex items-center justify-center">
                          <i class="fas fa-history text-sm md:text-base text-[var(--accent-secondary)] opacity-80"></i>
                        </div>
                        <div>
                          <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">${translations[alphaX_currentLanguage]?.period || 'Period'}</p>
                          <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">${item.periodDisplay || '-'}</p>
                        </div>
                      </div>
                      <div class="flex items-center space-x-2 md:space-x-3 text-center md:text-left">
                        <div>
                          <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">${translations[alphaX_currentLanguage]?.prediction || 'Prediction'}</p>
                          <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">${itemPrediction}</p> 
                        </div>
                      </div>
                      <div class="flex items-center space-x-2 md:space-x-3 mt-2 md:mt-0 md:ml-auto">
                         <div class="text-center">
                            <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">Actual</p>
                            <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">
                              ${item.actual !== undefined && item.resultType ? `${item.actual} (${item.resultType})` : (item.actual !== undefined ? item.actual : '-')}
                            </p>
                          </div>
                        <div class="history-status-icon-bg ${itemStatus.toLowerCase()}">
                          <i class="${iconClass} ${animationClass}"></i>
                        </div>
                        <button class="delete-btn text-[var(--text-light-secondary)] hover:text-[var(--loss-color)] transition p-1.5 rounded-full" data-id="${item.id}" aria-label="Delete history item">
                          <i class="fas fa-trash-alt text-sm md:text-base"></i>
                        </button>
                      </div>
                    </div>`;
                }).join("");
            }
            
            let pendingItemHtml = "";
            if (globalPredictionData && globalPredictionData.periodFull) {
                const isResolvedInHistory = localHistoryData.some(h => h.periodFull === globalPredictionData.periodFull && h.status !== "Pending");
                if (!isResolvedInHistory) { 
                    pendingItemHtml = `
                    <div class="history-item pending bg-[var(--bg-dark-secondary)] p-3 md:p-4 rounded-xl border border-[var(--card-border-color)] flex flex-col md:flex-row justify-between items-start md:items-center animate-bounceIn" 
                         data-id="pending-${globalPredictionData.periodFull}">
                      <div class="flex items-center space-x-2 md:space-x-3 mb-2 md:mb-0 flex-grow">
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-[var(--pending-color)] bg-opacity-20 rounded-full flex items-center justify-center">
                           <i class="fas fa-hourglass-half history-status-icon pending animate-spin"></i>
                        </div>
                        <div>
                          <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">${translations[alphaX_currentLanguage]?.period || 'Period'}</p>
                          <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">${globalPredictionData.periodDisplay || '-'}</p>
                        </div>
                      </div>
                      <div class="flex items-center space-x-2 md:space-x-3 text-center md:text-left">
                        <div>
                          <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">${translations[alphaX_currentLanguage]?.prediction || 'Prediction'}</p>
                          <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">${globalPredictionData.prediction || '-'}</p> 
                        </div>
                      </div>
                      <div class="flex items-center space-x-2 md:space-x-3 mt-2 md:mt-0 md:ml-auto">
                         <div class="text-center">
                            <p class="text-[var(--text-light-secondary)] text-xs md:text-sm">Confidence</p>
                            <p class="font-semibold text-[var(--text-light-primary)] text-sm md:text-base">${globalPredictionData.confidence || 0}%</p>
                          </div>
                        <div class="history-status-icon-bg pending">
                           <i class="fas fa-hourglass-half history-status-icon pending animate-spin"></i>
                        </div>
                      </div>
                    </div>`;
                }
            }

            container.innerHTML = pendingItemHtml + resolvedHistoryHtml;
            if (!container.innerHTML) {
                 container.innerHTML = `<p class="text-center text-text-light-secondary p-4" data-lang-key="no_history">${translations[alphaX_currentLanguage]?.no_history || 'No history yet.'}</p>`;
            }

            document.querySelectorAll('.delete-btn').forEach(button => {
                button.removeEventListener('click', handleDeleteSharedHistoryItem); 
                button.addEventListener('click', handleDeleteSharedHistoryItem);
            });
        }
        
        async function handleDeleteSharedHistoryItem(event) {
            const button = event.currentTarget;
            const itemId = button.getAttribute('data-id');
            if (!itemId || itemId.startsWith("pending-")) { 
                 alphaX_showLoginToast("Cannot delete a pending prediction from history.", "error");
                return;
            }
            
            alphaX_showConfirmModal('delete_item_confirm', async () => {
                try {
                    if(currentUser){
                        const idTokenResult = await getIdToken(currentUser);
                        if(idTokenResult.claims.admin){
                            await remove(ref(db, `${SHARED_GAME_HISTORY_PATH}/${itemId}`));
                            alphaX_showLoginToast("History item deleted.", 'info'); 
                            alphaX_playSound('confirm');
                        } else {
                             alphaX_showLoginToast("Only admins can delete history items.", 'error');
                        }
                    }
                } catch (error) {
                    console.error("Error deleting shared history item:", error);
                    alphaX_showLoginToast("Failed to delete item.", 'error');
                }
            });
        }

        function updateStatsUI_V2() {
            const actualWins = localHistoryData.filter(i => i.status === "WIN").length;
            const actualLosses = localHistoryData.filter(i => i.status === "LOSS").length;
            const totalPlayed = actualWins + actualLosses;
            const accuracyRate = totalPlayed > 0 ? ((actualWins / totalPlayed) * 100).toFixed(1) : 0;

            if(alphaX_totalWinBetsEl) alphaX_totalWinBetsEl.textContent = actualWins;
            if(alphaX_totalLossBetsEl) alphaX_totalLossBetsEl.textContent = actualLosses;
            if(alphaX_winRateEl) alphaX_winRateEl.textContent = `${accuracyRate}%`;

            if(alphaX_statsTotalWinsEl) alphaX_statsTotalWinsEl.textContent = actualWins;
            if(alphaX_statsTotalLossesEl) alphaX_statsTotalLossesEl.textContent = actualLosses;
            if(alphaX_statsWinRateEl) alphaX_statsWinRateEl.textContent = `${accuracyRate}%`;
            
            let currentStreak = 0;
            let currentStreakType = null;
            if (localHistoryData.length > 0) {
                currentStreakType = localHistoryData[0].status;
                if (currentStreakType === "WIN" || currentStreakType === "LOSS") {
                    for (const item of localHistoryData) {
                        if (item.status === currentStreakType) {
                            currentStreak++;
                        } else {
                            break;
                        }
                    }
                }
            }
            if(alphaX_currentStreakEl) {
                if (currentStreakType === "WIN" && currentStreak > 0) { alphaX_currentStreakEl.textContent = `W${currentStreak}`; alphaX_currentStreakEl.className = 'text-xl font-bold text-win-color'; }
                else if (currentStreakType === "LOSS" && currentStreak > 0) { alphaX_currentStreakEl.textContent = `L${currentStreak}`; alphaX_currentStreakEl.className = 'text-xl font-bold text-loss-color'; }
                else { alphaX_currentStreakEl.textContent = '-'; alphaX_currentStreakEl.className = 'text-xl font-bold text-text-light-primary'; }
            }

            if(alphaX_lastFiveActualsEl) {
                const lastFive = localHistoryData.filter(p => p.actual !== undefined).slice(0, 5).map(p => p.actual).join(', ') || '-';
                alphaX_lastFiveActualsEl.textContent = lastFive;
            }

            const bigSmallCounts = { BIG: 0, SMALL: 0 };
            localHistoryData.forEach(entry => { 
                if(entry.resultType === "BIG") bigSmallCounts.BIG++; 
                else if (entry.resultType === "SMALL") bigSmallCounts.SMALL++; 
            });
            if(alphaX_mostFrequentBigSmallEl && alphaX_leastFrequentBigSmallEl) {
                if (bigSmallCounts.BIG === 0 && bigSmallCounts.SMALL === 0) { alphaX_mostFrequentBigSmallEl.textContent = '-'; alphaX_leastFrequentBigSmallEl.textContent = '-'; }
                else if (bigSmallCounts.BIG >= bigSmallCounts.SMALL) { alphaX_mostFrequentBigSmallEl.textContent = 'BIG'; alphaX_leastFrequentBigSmallEl.textContent = bigSmallCounts.SMALL > 0 || bigSmallCounts.BIG === 0 ? 'SMALL' : (bigSmallCounts.BIG > 0 ? 'BIG' : '-'); }
                else { alphaX_mostFrequentBigSmallEl.textContent = 'SMALL'; alphaX_leastFrequentBigSmallEl.textContent = bigSmallCounts.BIG > 0 || bigSmallCounts.SMALL === 0 ? 'BIG' : (bigSmallCounts.SMALL > 0 ? 'SMALL' : '-'); }
            }
        }
        
        function alphaX_showBadTrendIndicator(show, message = "") {
            if (alphaX_badTrendIndicatorEl) {
                if (show) {
                    if(alphaX_badTrendMessageTextEl) alphaX_badTrendMessageTextEl.textContent = message || (translations[alphaX_currentLanguage]?.unstable_trend_detected || "Unstable trend detected - Predictions temporarily disabled");
                    alphaX_badTrendIndicatorEl.style.display = 'flex';
                } else {
                    alphaX_badTrendIndicatorEl.style.display = 'none';
                }
            }
        }
        
        function alphaX_showLoginToast(message, type = 'info') { 
            const toastEl = document.getElementById('loginToast'); 
            const messageEl = document.getElementById('loginToastMessage');
            const iconEl = toastEl.querySelector('.icon');
            if (!toastEl || !messageEl || !iconEl) return;
            messageEl.textContent = message;
            iconEl.className = 'icon fas '; 
            if (type === 'success') iconEl.classList.add('fa-check-circle', 'success');
            else if (type === 'error') iconEl.classList.add('fa-times-circle', 'error');
            else iconEl.classList.add('fa-info-circle', 'info');
            toastEl.style.display = 'flex';
            gsap.fromTo(toastEl, { y: 50, opacity: 0 }, { y: 0, opacity: 1, duration: 0.5, ease: "back.out(1.7)", onComplete: () => {
                gsap.to(toastEl, {opacity: 0, y: 50, duration: 0.5, delay: 3, ease: "power1.in", onComplete: () => {
                    toastEl.style.display = 'none';
                }});
            }});
        }
        
        function alphaX_updateLanguage() {
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[alphaX_currentLanguage]?.[key] || translations['en']?.[key]; 
                if (translation) {
                    if (element.tagName === 'UL' || element.tagName === 'P' || (element.tagName === 'LI' && translation.includes('<'))) { 
                        element.innerHTML = translation;
                    } else {
                        element.textContent = translation;
                    }
                }
            });
            updateHistoryUI_V2(); 
            updateStatsUI_V2();   

            const serverIndicator = document.getElementById('serverStatusIndicator');
            const isConnected = serverIndicator && serverIndicator.classList.contains('bg-win-color'); 
            alphaX_updateServerStatusUI(isConnected); 
        }

        function alphaX_playSound(type) { 
            if (!alphaX_isSoundEnabled) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                gainNode.gain.setValueAtTime(0.08, audioContext.currentTime); 

                switch(type) {
                    case 'win': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(600, audioContext.currentTime); break;
                    case 'loss': oscillator.type = 'square'; oscillator.frequency.setValueAtTime(200, audioContext.currentTime); break;
                    case 'notify': oscillator.type = 'triangle'; oscillator.frequency.setValueAtTime(440, audioContext.currentTime); break;
                    case 'confirm': case 'toggle': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(500, audioContext.currentTime); break;
                    default: gainNode.gain.setValueAtTime(0, audioContext.currentTime); 
                }
                if (gainNode.gain.value > 0) { 
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15); 
                }
            } catch (e) { console.warn("Sound play failed:", e); }
        }
        
        let mantenimientoData = {status: false, message: ""}; 
        function alphaX_updateServerStatusUI(isConnected, message = null) {
            const lang = alphaX_currentLanguage; 
            const maintenanceSnapshot = mantenimientoData; 
            
            if(alphaX_serverStatusEl && alphaX_serverStatusIndicator) {
                 if (maintenanceSnapshot && maintenanceSnapshot.status === true) {
                    alphaX_serverStatusEl.textContent = maintenanceSnapshot.message || translations[lang]?.under_maintenance || translations['en']?.under_maintenance;
                    alphaX_serverStatusIndicator.className = 'w-3 h-3 bg-warning-color rounded-full';
                } else if (isConnected) {
                    alphaX_serverStatusEl.textContent = message || translations[lang]?.connected || translations['en']?.connected;
                    alphaX_serverStatusIndicator.className = 'w-3 h-3 bg-win-color rounded-full animate-ping';
                } else {
                    alphaX_serverStatusEl.textContent = message || translations[lang]?.disconnected || translations['en']?.disconnected;
                    alphaX_serverStatusIndicator.className = 'w-3 h-3 bg-loss-color rounded-full';
                }
            }
        }

        function alphaX_openVideoPopup() { if(alphaX_youtubeVideoEl) alphaX_youtubeVideoEl.src = "https://www.youtube.com/embed/dQw4w9WgXcQ"; if(alphaX_videoPopupEl) alphaX_videoPopupEl.classList.add('active'); alphaX_playSound('toggle'); }
        function alphaX_closeVideoPopup() { if(alphaX_youtubeVideoEl) alphaX_youtubeVideoEl.src = ""; if(alphaX_videoPopupEl) alphaX_videoPopupEl.classList.remove('active'); alphaX_playSound('toggle'); }
        let alphaX_currentConfirmCallback = null;
        function alphaX_showConfirmModal(messageKey, onConfirm) { const message = translations[alphaX_currentLanguage]?.[messageKey] || translations['en']?.[messageKey] || "Are you sure?"; if(alphaX_modalMessageEl) alphaX_modalMessageEl.textContent = message; if(alphaX_confirmModalEl) alphaX_confirmModalEl.classList.add('active'); alphaX_currentConfirmCallback = onConfirm; alphaX_playSound('notify'); }
        function alphaX_resetSettings() { alphaX_showConfirmModal('reset_settings_confirm', () => { alphaX_currentLanguage = 'en'; alphaX_isSoundEnabled = true; alphaX_isNotificationsEnabled = false; localStorage.setItem('alphaXAiLanguage', alphaX_currentLanguage); localStorage.setItem('alphaXAiSound', alphaX_isSoundEnabled.toString()); localStorage.setItem('alphaXAiNotifications', alphaX_isNotificationsEnabled.toString()); document.getElementById('languageToggle').checked = false; document.getElementById('notificationToggle').checked = false; document.getElementById('soundToggle').checked = true; alphaX_updateLanguage(); alphaX_showLoginToast('Settings reset to default.', 'info'); alphaX_playSound('confirm'); }); }
        function alphaX_pausePredictionsUserInitiated(minutes) { alphaX_showLoginToast(`Pause for ${minutes}min requested - logic to be fully implemented.`, 'info');} 
        function alphaX_disablePredictionsUserInitiated(minutes) {alphaX_showLoginToast(`Disable for ${minutes}min requested - logic to be fully implemented.`, 'info');} 

        function initializeAppPredictor() {
            console.log("Initializing AlphaX Predictor (Backend Powered)...");
            
            const langToggle = document.getElementById('languageToggle');
            if(langToggle) langToggle.checked = alphaX_currentLanguage === 'hi';
            const notifToggle = document.getElementById('notificationToggle');
            if(notifToggle) notifToggle.checked = alphaX_isNotificationsEnabled;
            const soundToggle = document.getElementById('soundToggle');
            if(soundToggle) soundToggle.checked = alphaX_isSoundEnabled;
            isMuted = !alphaX_isSoundEnabled;

            alphaX_updateLanguage(); 
            setupFirebaseListeners(); 

            if (predictionIntervalId) clearInterval(predictionIntervalId);
            
            triggerBackendPredictionCycle(); 
            predictionIntervalId = setInterval(() => {
                if (currentUser && appContainer.classList.contains('active')) { 
                    triggerBackendPredictionCycle();
                } else {
                    console.log("Skipping prediction cycle: User not logged in or app not active.");
                }
            }, 15000); 

            if (alphaX_isNotificationsEnabled && Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission !== 'granted') {
                        alphaX_isNotificationsEnabled = false;
                        localStorage.setItem('alphaXAiNotifications', 'false');
                        if(notifToggle) notifToggle.checked = false;
                        alphaX_showLoginToast('Notifications permission denied.', 'error');
                    } else {
                         alphaX_showLoginToast('Notifications enabled!', 'success');
                    }
                });
            }

            const alphaX_navItems = document.querySelectorAll('#appContainer .navigation ul li');
            const alphaX_sections = document.querySelectorAll('#appContainer .content-section');
            alphaX_navItems.forEach((item) => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    alphaX_navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    const sectionId = item.querySelector('a').getAttribute('data-section');
                    alphaX_sections.forEach(section => section.classList.remove('active'));
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        gsap.fromTo(targetSection, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.3, ease: "power1.out"});
                    }
                    alphaX_playSound('toggle'); 
                });
            });
            const homeNavLi = document.querySelector('#appContainer .navigation ul li a[data-section="homeSection"]')?.closest('li');
            if (homeNavLi) {
                alphaX_navItems.forEach(li => li.classList.remove('active'));
                homeNavLi.classList.add('active');
            }
            const homeSection = document.getElementById('homeSection');
            if(homeSection && !homeSection.classList.contains('active')) {
                 alphaX_sections.forEach(section => section.classList.remove('active'));
                homeSection.classList.add('active');
            }
        }
        
        get(ref(db, MAINTENANCE_STATUS_PATH)).then(snapshot => {
            mantenimientoData = snapshot.val() || {status: false, message: ""};
        }).catch(error => {
            console.error("Failed to fetch initial maintenance status:", error);
            mantenimientoData = {status: false, message: "Error fetching status"};
        });


        document.addEventListener('DOMContentLoaded', function() {
            const langToggle = document.getElementById('languageToggle');
            if(langToggle) langToggle.addEventListener('change', (e) => { alphaX_currentLanguage = e.target.checked ? 'hi' : 'en'; localStorage.setItem('alphaXAiLanguage', alphaX_currentLanguage); alphaX_updateLanguage(); alphaX_playSound('toggle'); });
            const notifToggle = document.getElementById('notificationToggle');
            if(notifToggle) notifToggle.addEventListener('change', (e) => { alphaX_isNotificationsEnabled = e.target.checked; localStorage.setItem('alphaXAiNotifications', alphaX_isNotificationsEnabled.toString()); if(alphaX_isNotificationsEnabled && Notification.permission !== "granted") { Notification.requestPermission().then(p => { if(p !== 'granted') { alphaX_isNotificationsEnabled = false; localStorage.setItem('alphaXAiNotifications', 'false'); e.target.checked = false; alphaX_showLoginToast('Notifications denied.', 'error');} else {alphaX_showLoginToast('Notifications enabled!', 'success');} }); } else if (!alphaX_isNotificationsEnabled) { alphaX_showLoginToast('Notifications disabled.', 'info');} alphaX_playSound('toggle'); });
            const soundToggle = document.getElementById('soundToggle');
            if(soundToggle) soundToggle.addEventListener('change', (e) => { alphaX_isSoundEnabled = e.target.checked; localStorage.setItem('alphaXAiSound', alphaX_isSoundEnabled.toString()); isMuted = !alphaX_isSoundEnabled; if (alphaX_isSoundEnabled) alphaX_playSound('toggle'); });
            
            const deleteAllHistoryBtn = document.getElementById('deleteAllHistoryBtn');
            if(deleteAllHistoryBtn) deleteAllHistoryBtn.addEventListener('click', () => { 
                alphaX_showConfirmModal('delete_all_confirm', async () => { 
                    try {
                        const user = auth.currentUser;
                        if (user) {
                            const idTokenResult = await getIdToken(user, true); 
                            if (idTokenResult.claims.admin) {
                                if (BACKEND_URL === "YOUR_REPLIT_BACKEND_URL_HERE" || !BACKEND_URL.startsWith("https://")) {
                                    alphaX_showLoginToast("Backend not configured for this action.", "error"); return;
                                }
                                const response = await fetch(`${BACKEND_URL}deleteAllHistory`, { // Ensure no double slash
                                    method: 'POST',
                                    headers: { 'Authorization': `Bearer ${await getIdToken(user)}` }
                                });
                                if(response.ok) {
                                    alphaX_showLoginToast('All history and stats cleared by backend.', 'info'); 
                                } else {
                                    const errData = await response.json().catch(()=>({message: "Unknown error clearing history"}));
                                    alphaX_showLoginToast(`Failed to clear history: ${errData.message || response.statusText}`, 'error');
                                }
                            } else {
                               alphaX_showLoginToast('You do not have permission to clear all history.', 'error');
                            }
                        } else {
                             alphaX_showLoginToast('You must be logged in to perform this action.', 'error');
                        }
                    } catch (error) {
                        console.error("Error calling delete all history endpoint:", error);
                        alphaX_showLoginToast("Failed to clear all history.", "error");
                    }
                }); 
            });

            const confirmModalBtn = document.getElementById('confirmModalBtn');
            if(confirmModalBtn) confirmModalBtn.addEventListener('click', () => { if (alphaX_currentConfirmCallback) alphaX_currentConfirmCallback(); if(alphaX_confirmModalEl) alphaX_confirmModalEl.classList.remove('active'); alphaX_playSound('confirm'); alphaX_currentConfirmCallback = null; });
            const cancelModalBtn = document.getElementById('cancelModalBtn');
            if(cancelModalBtn) cancelModalBtn.addEventListener('click', () => { if(alphaX_confirmModalEl) alphaX_confirmModalEl.classList.remove('active'); alphaX_playSound('toggle'); alphaX_currentConfirmCallback = null; });
            
            const videoPopupEl_listener = document.getElementById('videoPopup');
            const videoPopupCloseButtons = videoPopupEl_listener ? videoPopupEl_listener.querySelectorAll('button[onclick*="alphaX_closeVideoPopup"]') : []; 
            videoPopupCloseButtons.forEach(btn => btn.addEventListener('click', alphaX_closeVideoPopup));

            const streakBreakPopupEl_listener = document.getElementById('streakBreakPopup');
            const streakBreakContinueButton = streakBreakPopupEl_listener ? streakBreakPopupEl_listener.querySelector('#cancelStreakModalBtn') : null;
            if(streakBreakContinueButton) streakBreakContinueButton.addEventListener('click', () => { if(alphaX_streakBreakPopupEl) alphaX_streakBreakPopupEl.classList.remove('active'); alphaX_playSound('toggle');});
            
            const badTrendPopupEl_listener = document.getElementById('badTrendPopup');
            const badTrendContinueButton = badTrendPopupEl_listener ? badTrendPopupEl_listener.querySelector('#cancelBadTrendModalBtn') : null;
            if(badTrendContinueButton) badTrendContinueButton.addEventListener('click', () => { if(alphaX_badTrendPopupEl) alphaX_badTrendPopupEl.classList.remove('active'); alphaX_playSound('toggle');});

        });
    </script>
</body>
</html>
